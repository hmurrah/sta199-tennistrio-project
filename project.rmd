---
title: "Project Draft - Tennis Trio"
subtitle: "Due Friday, October 9, 11:59 PM"
author: "Tennis Trio: Hamilton Murrah, Kellyn McDonald, Naima Turbes"
output: pdf_document
---
```{r packages-data, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidytext)
wine_data <- read_csv("data/winemag-data_first150k.csv") 
```

### Introduction

People have cultivated and appreciated wines for millennia. In fact, the oldest known winery was found in a cave outside of a village in Armenia and dates back to 4,100 BC. Since then, wine production and consumption spread throughout the globe and become a important part of many cultures. Today, wine is largely used as a celebratory drink during activities like weddings or holidays. Fine wines are often more expensive and associated with higher societal status or class (https://winefolly.com/deep-dive/where-did-wine-come-from/#:~:text=Ancient%20wine%20production%20evidence%20dates,grape%20domestication%20in%20eastern%20Turkey). 


We investigated wine ratings from wine enthusiasts around the globe using wine ranking data scraped from WineEnthusiast.com.

Our main motivation for investigating wine data is pure interest and desire to understand how to select the best wine. We are specifically interested in how the perceived quality of these wines varies based on where they were produced. Additionally, we want to understand what words wine enthusiasts use to describe highly rated wines versus lower rated wines. Finally, in an attempt to find the best wine to buy, we want to investigate and characterize what wines have the best value for their rating. We hypothesize that the best wines are also the most expensive wines, come from France and Italy, and are described using positive descriptors.



### Data Description

User zackthoutt on Kaggle collected this data by scraping data from WineEnthusiast.com.

A description of the columns of our data set are as follows

- `X1`: Number corresponding to the observation. Listed in ascending order from 0
- `country`: The country that the wine is from
- `description`: A few sentences from a sommelier describing the wine's taste, smell, look, feel, etc.
- `designation`: The vineyard within the winery where the grapes that made the wine are from
- `points`: The number of points WineEnthusiast rated the wine on a scale of 1-100 (though they say they only post reviews for wines that score $\geq$ 80)
- `price`: The cost for a bottle of the wine
- `province`: The province or state that the wine is from
- `region_1`: The wine growing area in a province or state (ie Napa)
- `region_2`: Sometimes there are more specific regions specified within a wine growing area (ie Rutherford inside the Napa Valley), but this value can sometimes be blank
- `variety`: The type of grapes used to make the wine (ie Pinot Noir)
- `winery`: The winery that made the wine


### Methodology
 
We will perform the following tests and statistical methods to evaluate our research question.
 
1. We will calculate on average which country has the highest rated wines by calculating the mean scores of each country and summarizing the data into a table. We will also visualize this data using a histogram.
 
2. We will evaluate whether or not it is appropriate to use CLT based tests on the data set using ...
 
3. We will use a CLT based t test to determine whether there is a statistically significant difference between the highest rated country's average score and the average wine score for all countries.
 
4. We will calculate ratio of wine score and price and determine the best value wine for its price. We will visualize these ratios using a scatterplot and compare the weighted ratio versus actual price.
** have countries be different colors
 
5. We will calculate on average which variety of wine has the highest rating  by calculating the mean scores of each variety and summarizing the data into a table. We will also visualize this data using a histogram.
 
6. We will use text analysis on the description variable to pick out key word descriptors in order to determine if there is there a relationship between the descriptor and the score. We will visualize this relationship.

### Glimpse of data

```{r}
glimpse(wine_data)
```

### Results
``` {r highest_average_score_by_country, echo = FALSE, warning = F, message = F}
country_counts <- wine_data %>%
    group_by(country) %>%
    count(country) %>%
    filter(n >= 100)

relevant_countries <- wine_data %>%
    filter(!is.na(points) & !is.na(price)) %>%
    filter(country %in% country_counts$country)

best_country <- relevant_countries %>%
    filter(!is.na(country)) %>%
    select(country, points, price) %>%
    group_by(country) %>%
    summarize(avg = mean(points)) %>%
    arrange(desc(avg)) %>%
    top_n(3)
best_country

score_test <- wine_data %>%
    filter(!is.na(country)) %>%
    group_by(country) %>%
    summarize(avg = mean(points))
score_test

weighted_avg_test <- wine_data %>%
    group_by(country) %>%
    mutate(weighted_count = (points/price))
weighted_avg_test

```

Contrary to our hypothesis, Italy and France are nowhere to be seen in the top 5 or even the top 10 average scoring countries. The top 5 countries with the highest average wine score are Australia, Austria, New Zealand, Switzerland, and Israel, in that order.

We recognize that this list of top 5 countries may not be an accurate representation of where the best wines come from, but rather a representation of what location on average has the wines with the highest point ratings. This calculation rewards countries with one highly rated wine and disadvantages countries that have wines represented in the data set with both very high and very low point values.

```{r highest_average_points_by_variety, warning = F, message = F}
variety_means <- wine_data %>% 
    group_by(variety) %>% 
    summarize(mean = mean(points)) %>% 
    arrange(desc(mean)) %>% 
    top_n(5)
variety_means

variety_counts <- wine_data %>%
    group_by(variety) %>%
    count(variety) %>%
    filter(n >= 50)

variety_means_more_than_50 <- wine_data %>%
    group_by(variety) %>% 
    summarize(mean = mean(points)) %>% 
    arrange(desc(mean)) %>% 
    filter(variety %in% variety_counts$variety) %>%
    top_n(5)
variety_means_more_than_50
```

We calculated the top 5 best rated varieties of wine similarly. Our first calculation returned Cabernet-Shiraz, Cabernet Sauvignon-Shiraz, Blauburgunder, Friulano, and Carignan as the top rated wine varieties. However, after observing the data, we noticed that these wine varieties had a relatively small number of wines represented in the entire data set. To try to better represent the varieties of wines with consistently top rated products, we filtered to only include wine varieties with at least 50 wines ratings represented in the data set. The top varieties presented in this calculation were Gewürztraminer, Grüner Veltliner, Pinot Gris, Pinot Noir, and Riesling. 


```{r}

# I was trying to visualize all point values on a scatter plot and color by either top 5 varieties or not, then color by either top 5 countries or not and then also create a linear model with country and variety as factors. It looks like there is a problem with the variety variable that I tried to create. It shows up as countries instead of varieties and im not quite sure why.


countryvar <- wine_data %>%
  mutate(top_countries = if_else(country == "Austria" |
                               country == "Germany" |
                               country == "France",
                           country, "Other"))

ggplot(data = countryvar, mapping = aes(y = points, x = price, color = top_countries)) + 
    geom_point()
  

varietyvar <- wine_data %>%
  mutate(top_varieties = if_else(variety == "Cabernet-Shiraz" |
                               variety == "Cabernet Sauvignon-Shiraz" |
                               variety == "Blauburgunder",
                           country, "Other"))

ggplot(data = varietyvar, mapping = aes(x = price, y = points, color = top_varieties)) + 
    geom_point()

varietyvar2 <- wine_data %>%
  mutate(top_varieties2 = if_else(variety == "Gewürztraminer" |
                               variety == "Grüner Veltliner" |
                               variety == "Pinot Gris",
                           country, "Other"))

ggplot(data = varietyvar2, mapping = aes(x = price, y = points, color = top_varieties2)) + 
    geom_point()


lmthingy <- wine_data %>%
  mutate(top_countries = if_else(country == "Austria" |
                               country == "Germany" |
                               country == "France",
                           country, "Other")) %>%
  mutate(top_varieties2 = if_else(variety == "Gewürztraminer" |
                               variety == "Grüner Veltliner" |
                               variety == "Pinot Gris",
                           country, "Other")) 
modell <- lm(points ~ top_countries + top_varieties2, data = lmthingy)
tidy(modell)

  
  

```




What are the most commonly used words to describe a merlot for example. Is there a difference in the types of words used to describe the types of wines based on region, type, price.

Are the presence of certain words associated with higher price. Fit a linear regression model. Definitely mention which words we also take out as stop words.
``` {r sentiment_analysis_all_wine, message = F, warning = F}
descriptions <- tibble(txt = wine_data$description)
unnested_all <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers")
unnested_all %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In All Wines",
         y = "",
         x = "")
```


``` {r sentiment_analysis_top_5_varieties, message = F, warning = F}
Gewürztraminer <- wine_data %>%
    filter(variety == "Gewürztraminer")
descriptions <- tibble(txt = Gewürztraminer$description)
unnested_Gewürztraminer <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long" &
               word != "pinot" & word != "gris" & word != "generous" &
               word != "hints" & word != "gewürztraminer" & word != "noir" &
               word != "riesling" & word != "grüner" & word != "veltliner")
unnested_Gewürztraminer %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Gewürztraminer Wines",
         x = "Descriptor Words",
         y = "Frequency")

Grüner_Veltliner <- wine_data %>%
    filter(variety == "Grüner Veltliner")
descriptions <- tibble(txt = Grüner_Veltliner$description)
unnested_Grüner_Veltliner <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long" &
               word != "pinot" & word != "gris" & word != "generous" &
               word != "hints" & word != "gewürztraminer" & word != "noir" &
               word != "riesling" & word != "grüner" & word != "veltliner")
unnested_Grüner_Veltliner %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Grüner Veltliner Wines",
         x = "Descriptor Words",
         y = "frequency")

Pinot_Gris <- wine_data %>%
    filter(variety == "Pinot Gris")
descriptions <- tibble(txt = Pinot_Gris$description)
unnested_Pinot_Gris <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long" &
               word != "pinot" & word != "gris" & word != "generous" &
               word != "hints" & word != "gewürztraminer" & word != "noir" &
               word != "riesling" & word != "grüner" & word != "veltliner")
unnested_Pinot_Gris %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Pinot Gris Wines",
         x = "Descriptor Words",
         y = "Frequency")

Pinot_Noir <- wine_data %>%
    filter(variety == "Pinot Noir")
descriptions <- tibble(txt = Pinot_Noir$description)
unnested_Pinot_Noir <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long" &
               word != "pinot" & word != "gris" & word != "generous" &
               word != "hints" & word != "gewürztraminer" & word != "noir" &
               word != "riesling" & word != "grüner" & word != "veltliner")
unnested_Pinot_Noir %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Pinot Noir Wines",
         x = "Descriptor Words",
         y = "Frequency")

Riesling <- wine_data %>%
    filter(variety == "Riesling")
descriptions <- tibble(txt = Riesling$description)
unnested_Riesling <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long" &
               word != "pinot" & word != "gris" & word != "generous" &
               word != "hints" & word != "gewürztraminer" & word != "noir" &
               word != "riesling" & word != "grüner" & word != "veltliner")
unnested_Riesling %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Riesling Wines",
         x = "Descriptor Words",
         y = "Frequency")
```

``` {r sentiment_analysis_price_over_100, warning = F, message = F}
over_100 <- wine_data %>%
    filter(price >= 100)
descriptions <- tibble(txt = over_100$description)
unnested_over_100 <- descriptions %>%
  unnest_tokens(word, txt) %>%
    filter(word != "wine" & word != "flavors" & word != "palate" &
               word != "drink" & word != "aromas" & word != "offers" &
               word != "finish" & word != "notes" & word != "long")
unnested_Gewürztraminer %>%
  anti_join(get_stopwords(source = "smart")) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  top_n(20) %>%
  ggplot(aes(fct_reorder(word, n), n)) +
    geom_col() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Frequency Of Descriptor Words In Expensive Wines",
         y = "Frequency",
         x = "Descriptor Words")
```

``` {r average_wine_score_clt, message = FALSE, warning = FALSE, echo = FALSE}
t.test(wine_data$points,
       mu = 90.93939,
       alternative = "two.sided")
```
Here, we see that the overall mean of all wine scores is 88.88125 and has a 95% confidence interval or 88.82544 to 88.93706. This shows us that our observed average score of 90.93939 for Australia has statistical significance in its difference from the mean.



``` {r weighted_wine_scores_to_price, message = FALSE, warning = FALSE}
weighted_avg <- wine_data %>%
    group_by(country)%>%
    summarize(country, winery, variety, price, country, points, weighted = points/price) %>%
        arrange(desc(weighted))
```

```{r weighted_wine_scores_to_price, message = FALSE, warning = FALSE, echo = FALSE}
weighted_avg

ggplot(data = wine_data, mapping = aes(x = price, y = points)) + geom_point() + geom_smooth(method = "lm", se = F) + facet_wrap(~top_3)

weighted_avg <- relevant_countries %>% 
    mutate(weighted = log((points/price), base = exp(1))) %>% 
    mutate(top_3 = if_else(country == "Austria" |
                               country == "Germany" |
                               country == "France",
                           country, "Other"))

weighted_avg

ggplot(data = weighted_avg, mapping = aes(x = price, y = weighted)) + 
    geom_point() + 
    geom_smooth(method = "lm", se = F) + facet_wrap(~top_3)


ggplot(data = weighted_avg, mapping = aes(x = price, y = weighted, color = top_3)) +
    geom_smooth(method = "lm") +
    geom_point()
```
*** we are trying to make graph that has countries on the x axis and a weighted count of wines on the y axis. the weighted count will be equal to the count of wines in the top 100 times the weighted points/ price score. 


``` {r}
m_points = glm(price ~ points, data = weighted_avg)
tidy(m_points)
```

```{r}
country_counts <- wine_data %>%
    group_by(country) %>%
    count(country) %>%
    filter(n >= 100)


top_countries <- wine_data %>% 
  filter(country == "Germany" |
           country == "France" |
           country == "Italy" |
           country == "Austria" |
           country == "Spain" |
           country == "Portugal")

ggplot(data = top_countries, mapping = aes(points)) + 
  geom_density() + 
  facet_wrap(~country)
```

### Discussion



### References
